<!-- *  file: lazurite.html
 *
 *  Copyright (C) 2016-17 Lapis Semiconductor Co., Ltd.
 *
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the "License"); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *	  http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
!-->
<script type="text/x-red" data-template-name="lazurite-mac">
	<div class="form-row">
		<label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
		<input type="text" id="node-input-name">
	</div>
	<div class="form-row">
		<label for="node-input-channel"><i class="fa fa-diamond"></i> ch config</label>
		<input type="lazurite-channel" id="node-input-channel"></input>
	</div>
</script>
<script type="text/javascript">
	RED.nodes.registerType('lazurite-mac',{
		category: 'Lazurite',
		paletteLabel: 'Lazurite MAC',
		color:"#3FADB5",
		align: 'left',
		inputs:1,
		outputs:1,
		icon: "lazurite.png",
		label: function() {
			return this.name || "Lazurite MAC";
		},
		labelStyle: function() {
			return this.text?"node_label_italic":"";
		},
		defaults: {
			channel: {value:"", required:true, type:"lazurite-channel"},
			name   : {value:""}
		}
	});
</script>
<script type="text/x-red" data-help-name="lazurite-mac">

<p>get MAC Address of Lazurite.</p>
<p><br></p>
<p><b>INPUT</b></p>
<p>Just trigger of this process</p>
<p><br><p>
<p><b>OUTPUT</b></p>
<p><b>msg.payload.mac</b> is 64bit MAC address</p>
<p><b>msg.payload.panid</b> is panid</p>
<p><b>msg.payload.short</b> is short address</p>

</script>

<script type="text/x-red" data-template-name="lazurite-rx">
	<div class="form-row">
		<label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
		<input type="text" id="node-input-name">
	</div>
	<div class="form-row">
		<label for="node-input-channel"><i class="fa fa-diamond"></i> ch config</label>
		<input type="lazurite-channel" id="node-input-channel"></input>
	</div>
	<div class="form-row">
		<label for="node-input-broadcastenb"><i class="fa fa-chain"></i> Broadcast</label>
		<input type="checkbox" id="node-input-broadcastenb" style="width:20px;"> enable</input>
	</div>
</script>
<script type="text/javascript">
	RED.nodes.registerType('lazurite-rx',{
		category: 'Lazurite',
		paletteLabel: 'Lazurite Rx',
		color:"#3FADB5",
		align: 'left',
		inputs:0,
		outputs:1,
		icon: "lazurite.png",
		label: function() {
			return this.name || "lazurite Rx";
		},
		labelStyle: function() {
			return this.text?"node_label_italic":"";
		},
		defaults: {
			channel: {value:"", required:true, type:"lazurite-channel"},
			latestpacket: {value:false},
			broadcastenb: {value:true},
			name   : {value:""}
		}
	});
</script>
<script type="text/x-red" data-help-name="lazurite-rx">

<p><br></p>
<p><li>msg.payload</li></p>
<p><b> msg.payload </b> is payload</p>

<p><li>msg.header</li></p>
<p><b>msg.header</b> is MAC header of receiving packet</p>

<p><li>msg.seq_num</li></p>
<p><b>msg.seq_num</b> is sequence number</p>

<p><li>msg.dst_panid</li></p>
<p><b> msg.dst_panid </b> is panid</p>

<p><li>msg.dst_addr</li></p>
<p><b> msg.dst_addr </b> is distination address</p>

<p><li>msg.src_addr</li></p>
<p><b> msg.src_addr </b> is source address</p>

<p><li>msg.rssi</li></p>
<p><b> msg.rssi </b> is rssi of receiving packet</p>

<p><li>msg.rxtime</li></p>
<p><b> msg.rxtime </b> is receiving time</p>

</script>

<script type="text/x-red" data-template-name="lazurite-tx">
	<div class="form-row">
		<label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
		<input type="text" id="node-input-name">
	</div>
	<div class="form-row">
		<label for="node-input-channel"><i class="fa fa-diamond"></i> ch config</label>
		<input type="lazurite-channel" id="node-input-channel"></input>
	</div>
	<div class="form-row">
		<label for="node-input-dst_panid"><i class="fa fa-user"></i> dst panid</label>
		<input type="text" id="node-input-dst_panid" placeholder="panid of receiver.">
	</div>
	<div class="form-row">
		<label for="node-input-dst_addr"><i class="fa fa-dot-circle-o"></i> dst addr</label>
		<input type="text" id="node-input-dst_addr" placeholder="16bit short address of receiver.">
	</div>
	<div class="form-row">
		<label for="node-input-ackreq"><i class="fa fa-chain"></i> Ack</label>
		<input type="checkbox" id="node-input-ackreq" style="width:20px;"> enable</input>
	</div>
</script>
<script type="text/javascript">
	RED.nodes.registerType('lazurite-tx',{
		category: 'Lazurite',
		paletteLabel: 'Lazurite Tx',
		color:"#3FADB5",
		align: 'right',
		inputs:1,
		outputs:1,
		icon: "lazurite.png",
		label: function() {
			return this.name || "Lazurite Tx";
		},
		labelStyle: function() {
			return this.text?"node_label_italic":"";
		},
		defaults: {
			channel:   {value:"", required:true, type:"lazurite-channel"},
			interval: {value:"10", required:true},
			dst_addr: {value:"0xffff", required:true},
			dst_panid: {value:"0xffff", required:true},
			ackreq: {value:true},
			name: {value:""}
		}
	});
</script>
<script type="text/x-red" data-help-name="lazurite-tx">

<p><br></p>
<p><b>INPUT</b></p>
<p><li>msg.payload</li></p>
<p><b>msg.payload</b> is message body. It must be string</p>

<p><li>msg.dst_panid</li></p>
<p><b>msg.dst_panid</b> is destination panid(16bit integer or the string).  When it is undefined, setting in this node is used.</p>

<p><li>msg.dst_addr</li></p>
<p><b>msg.dst_addr</b> is destination address(16bit integer or the string). When it is undefined, setting in this node is used.</p>

<p><li>msg.ackreg</li></p>
<p><b>msg.ackreq</b> is boolean value. Enable/Disable ack request. When it is undefined, setting in this node is used.</p>

<p><li>msg.ret.success</li></p>
<p><b>msg.ret.success</b> is true or false</p>

<p><b>OUTPUT</b></p>
<p><li><b>msg.ret.rssi</b></li></p>
<p><b>msg.ret.rssi</b> is rssi of ack</p>

<p><li>msg.ret.eack</li></p>
<p><b>msg.ret.eack</b> is Uint8Array type data of enhance ack</p>

<p><li>msg.ret.errcode</li></p>
<p><b>msg.ret.errcode</b> is error code, when send is failed.</p>

<p><li> msg.ret.errmsg</li></p>
<p><b> msg.ret.errmsg</b> is error message, when send is failed.</p>

</script>


<script type="text/x-red" data-template-name="lazurite-tx64">
	<div class="form-row">
		<label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
		<input type="text" id="node-input-name">
	</div>
	<div class="form-row">
		<label for="node-input-channel"><i class="fa fa-diamond"></i> ch config</label>
		<input type="lazurite-channel" id="node-input-channel"></input>
	</div>
	<div class="form-row">
		<label for="node-input-dst_addr0"><i class="fa fa-dot-circle-o"></i> dst addr</label>
		<input type="text" id="node-input-dst_addr0" placeholder="001D" style="width:50px">
		<input type="text" id="node-input-dst_addr1" placeholder="1290" style="width:50px">
		<input type="text" id="node-input-dst_addr2" placeholder="0004" style="width:50px">
		<input type="text" id="node-input-dst_addr3" placeholder="0000" style="width:50px">
	</div>
	<div class="form-row">
		<label for="node-input-ackreq"><i class="fa fa-chain"></i> Ack</label>
		<input type="checkbox" id="node-input-ackreq" style="width:20px;"> enable</input>
	</div>
</script>
<script type="text/javascript">
	RED.nodes.registerType('lazurite-tx64',{
		category: 'Lazurite',
		paletteLabel: 'Lazurite TX64',
		color:"#3FADB5",
		align: 'right',
		inputs:1,
		outputs:1,
		icon: "lazurite.png",
		label: function() {
			return this.name || "lazurite TX64";
		},
		labelStyle: function() {
			return this.text?"node_label_italic":"";
		},
		defaults: {
			channel:   {value:"", required:true, type:"lazurite-channel"},
			dst_addr0: {value:"001D", required:true},
			dst_addr1: {value:"1290", required:true},
			dst_addr2: {value:"0004", required:true},
			dst_addr3: {value:"0000", required:true},
			ackreq: {value:true},
			name: {value:""}
		}
	});
</script>
<script type="text/x-red" data-help-name="lazurite-tx64">

<p><br></p>
<p><b>INPUT</b></p>

<p><li>msg.payload</li></p>
<p><b>msg.payload</b> is message body. It must be string</p>

<p><li>msg.dst_addr</li></p>
<p><b>msg.dst_addr</b> is destination address(hex string of 64bit MAC or BigInt value)</p>

<p><li>msg.ackreg</li></p>
<p><b>msg.ackreq</b> is boolean value. Enable/Disable ack request</p>

<p><li>msg.ret.success</li></p>
<p><b>msg.ret.success</b> is true or false</p>

<p><br></p>

<p><b>OUTPUT</b></p>

<p><li>msg.ret.rssi</li></p>
<p><b>msg.ret.rssi</b> is rssi of ack</p>

<p><li>msg.ret.errcode</li></p>
<p><b>msg.ret.errcode</b> is error code, when send is failed.</p>

<p><li> msg.ret.errmsg</li></p>
<p><b> msg.ret.errmsg</b> is error message, when send is failed.</p>

</script>

<script type="text/x-red" data-template-name="lazurite-setenhanceack">
	<div class="form-row">
		<label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
		<input type="text" id="node-input-name">
	</div>
	<div class="form-row">
		<label for="node-input-channel"><i class="fa fa-diamond"></i> ch config</label>
		<input type="lazurite-channel" id="node-input-channel"></input>
	</div>
</script>
<script type="text/javascript">
	RED.nodes.registerType('lazurite-setenhanceack',{
		category: 'Lazurite',
		paletteLabel: 'Set EnhanceACK',
		color:"#3FADB5",
		align: 'left',
		inputs:1,
		outputs:1,
		icon: "lazurite.png",
		label: function() {
			return this.name || "SetEnhanceACK";
		},
		labelStyle: function() {
			return this.text?"node_label_italic":"";
		},
		defaults: {
			channel:   {value:"", required:true, type:"lazurite-channel"},
		}
	});
</script>
<script type="text/x-red" data-help-name="SetEnhanceACK">
	<p>Parameters for Enhance ACK of Lazurite-Gateway.</p>
	<p>Outputs a message with the properties:
		<li>msg.payload</li>
	</p>
	<p><b>msg.payload</b> is payload to be sent.</p>
	<p><b>msg.dst_panid</b> is panid of receiver. If it is not set, dst_panid in GUI is in use.</p>
	<p><b>msg.dst_addr</b> is 4 integers array of receiver address. currentry msg.dst_addr[0] is valid. If it is not set, dst_addr in GUI is in use.</p>
</script>

<script type="text/x-red" data-template-name="lazurite-channel">
	<div class="form-row">
		<label for="node-config-input-ch"><i class="fa fa-dot-circle-o"></i> ch</label>
		<input type="text" id="node-config-input-ch" placeholder="RF frequency.">
	</div>
	<div class="form-row">
		<label for="node-config-input-panid"><i class="fa fa-user"></i> panid</label>
		<input type="text" id="node-config-input-panid" placeholder="PANID.">
	</div>
	<div class="form-row">
		<label for="node-config-input-rate"><i class="fa fa-list-ul"></i> rate</label>
		<select id="node-config-input-rate">
			<option value=50>50 kbps</option>
			<option value=100>100 kbps</option>
		</select>
	</div>
	<div class="form-row">
		<label for="node-config-input-pwr"><i class="fa fa-rss"></i> pwr</label>
		<select id="node-config-input-pwr">
			<option value=1>1 mW</option>
			<option value=20>20 mW</option>
		</select>
	</div>
	<div class="form-row">
		<label for="node-config-input-interval"><i class="fa fa-clock-o"></i> Interval</label>
		<input type="checkbox" id="node-config-input-defaultinterval" style="width:20px;"> default</input>
		<input type="text" id="node-config-input-interval" style="width:80px; margin-left:20px;"></input>
		<label style="width:40px;">msec</label>
	</div>
	<div class="form-row">
		<label for="node-config-input-myaddr"><i class="fa fa-map-marker"></i> My Address</label>
		<input type="checkbox" id="node-config-input-defaultaddress" style="width:20px;"> default</input>
		<input type="text" id="node-config-input-myaddr" placeholder="my address" style="width:80px; margin-left:20px;"></input>
	</div>
	<div class="form-row">
		<label for="node-config-input-key"><i class="fa fa-key"></i> AES key</label>
		<input type="text" id="node-config-input-key" placeholder="128bit AES key"></input>
	</div>
	<div class="form-tips">in case of 100kbps, ch is 24-31, 33-60.<br>in case of 50kbps, ch is 24-61.</div>
</script>
<script type="text/javascript">
	RED.nodes.registerType('lazurite-channel',{
		category: 'config',
		defaults: {
			ch: {value:36,required:true,validate:RED.validators.number()},
			panid: {value:"0xabcd",required:true},
			rate: {value:100,required:true,validate:RED.validators.number()},
			pwr: {value:20,required:true,validate:RED.validators.number()},
			defaultinterval: {value:true,required: true},
			interval: {value:10,require:false,validate:RED.validators.number()},
			defaultaddress: {value:true,required:true},
			myaddr: {value:"0", required:true },
			key: {value:""}
		},
		label: function() {
			if(this.defaultaddress == true){
				return "ch:" + this.ch + " addr:" + this.panid + ",default";
			} else {
				return "ch:" + this.ch + " addr:" + this.panid + ","+this.myaddr;
			}
		}
	});
</script>
<script type="text/x-red" data-help-name="lazurite-channel">
	<p>Parameters for lazurite-channel</p>
	<p><li><b>Interval</b></li></P>
	<p>check receiving data by this interval, when enabling</p>
	<p><li><b>My Address</b></li></P>
	<p>Short address of this module</p>
	<p><li><b>AES Key</b></li></P>
	<p>AES Key for encrypt / decrypt payload</p>
	<p>"" is not set AES Key,</p>
	<p></p>
</script>
